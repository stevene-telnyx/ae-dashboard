<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AE Dashboard - ROE Tracker</title>
    <style>
        * { box-sizing: border-box; margin: 0; padding: 0; }
        body { 
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: #0f1419;
            color: #e7e9ea;
            padding: 20px;
        }
        .header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 24px;
            padding-bottom: 16px;
            border-bottom: 1px solid #2f3336;
        }
        h1 { font-size: 24px; font-weight: 600; }
        .sync-info { color: #71767b; font-size: 14px; }
        
        .stats {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 16px;
            margin-bottom: 24px;
        }
        .stat-card {
            background: #16181c;
            border: 1px solid #2f3336;
            border-radius: 12px;
            padding: 20px;
            text-align: center;
        }
        .stat-value { font-size: 36px; font-weight: 700; }
        .stat-label { color: #71767b; margin-top: 4px; }
        .stat-expired .stat-value { color: #f4212e; }
        .stat-expiring .stat-value { color: #ffd400; }
        .stat-active .stat-value { color: #00ba7c; }
        .stat-none .stat-value { color: #71767b; }
        .stat-hot .stat-value { color: #f97316; }
        
        .filters {
            display: flex;
            gap: 12px;
            margin-bottom: 16px;
            flex-wrap: wrap;
            align-items: center;
        }
        .filter-btn {
            background: #16181c;
            border: 1px solid #2f3336;
            color: #e7e9ea;
            padding: 8px 16px;
            border-radius: 20px;
            cursor: pointer;
            font-size: 14px;
            transition: all 0.2s;
        }
        .filter-btn:hover { background: #1d1f23; }
        .filter-btn.active { background: #1d9bf0; border-color: #1d9bf0; }
        .filter-btn.hot-filter.active { background: #f97316; border-color: #f97316; }
        .filter-btn.opp-filter.active { background: #eab308; border-color: #eab308; color: #000; }
        .filter-btn.notes-filter.active { background: #a855f7; border-color: #a855f7; }
        .filter-btn.bdr-filter.active { background: #06b6d4; border-color: #06b6d4; }
        
        .search {
            background: #16181c;
            border: 1px solid #2f3336;
            color: #e7e9ea;
            padding: 12px 16px;
            border-radius: 8px;
            width: 300px;
            font-size: 14px;
        }
        .search::placeholder { color: #71767b; }
        
        table {
            width: 100%;
            border-collapse: collapse;
            background: #16181c;
            border-radius: 12px;
            overflow: hidden;
        }
        th, td {
            text-align: left;
            padding: 12px 16px;
            border-bottom: 1px solid #2f3336;
        }
        th {
            background: #1d1f23;
            font-weight: 600;
            color: #71767b;
            font-size: 12px;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            cursor: pointer;
        }
        th:hover { color: #e7e9ea; }
        th.sorted-asc::after { content: ' ‚Üë'; }
        th.sorted-desc::after { content: ' ‚Üì'; }
        tr:hover { background: #1d1f23; }
        
        .status-badge {
            display: inline-block;
            padding: 4px 10px;
            border-radius: 12px;
            font-size: 12px;
            font-weight: 500;
        }
        .status-expired { background: #f4212e20; color: #f4212e; }
        .status-expiring_soon { background: #ffd40020; color: #ffd400; }
        .status-active { background: #00ba7c20; color: #00ba7c; }
        .status-no_activity { background: #71767b20; color: #71767b; }
        
        .priority-badge {
            display: inline-block;
            padding: 2px 8px;
            border-radius: 4px;
            font-size: 11px;
            font-weight: 600;
        }
        .priority-P1 { background: #f4212e; color: white; }
        .priority-P2 { background: #ffd400; color: black; }
        .priority-P3 { background: #71767b; color: white; }
        .priority-none { background: transparent; color: #71767b; }
        
        .hot-toggle {
            cursor: pointer;
            font-size: 18px;
            opacity: 0.3;
            transition: opacity 0.2s, transform 0.1s;
            user-select: none;
        }
        .hot-toggle:hover { opacity: 0.6; transform: scale(1.1); }
        .hot-toggle.is-hot { opacity: 1; }
        
        .opp-indicator { font-size: 18px; }
        .opp-none { opacity: 0.15; }
        
        .days-remaining { font-weight: 600; font-variant-numeric: tabular-nums; }
        .days-negative { color: #f4212e; }
        .days-warning { color: #ffd400; }
        .days-ok { color: #00ba7c; }
        
        a { color: #1d9bf0; text-decoration: none; }
        a:hover { text-decoration: underline; }
        
        .account-name { font-weight: 500; }
        .account-meta { color: #71767b; font-size: 12px; }
        
        .empty-state {
            text-align: center;
            padding: 60px;
            color: #71767b;
        }
        
        .export-btn {
            background: #2f3336;
            border: none;
            color: #e7e9ea;
            padding: 8px 16px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 12px;
        }
        .export-btn:hover { background: #3a3f44; }
        
        .note-cell {
            min-width: 200px;
            max-width: 300px;
        }
        .note-input {
            background: transparent;
            border: 1px solid transparent;
            color: #e7e9ea;
            font-size: 13px;
            padding: 4px 8px;
            border-radius: 4px;
            width: 100%;
            transition: all 0.2s;
        }
        .note-input:hover {
            background: #1d1f23;
            border-color: #2f3336;
        }
        .note-input:focus {
            background: #1d1f23;
            border-color: #1d9bf0;
            outline: none;
        }
        .note-input::placeholder {
            color: #71767b;
            font-style: italic;
        }
        .note-input.has-note {
            color: #a855f7;
        }
        
        /* Note Modal */
        .note-modal-overlay {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0,0,0,0.8);
            z-index: 1000;
            justify-content: center;
            align-items: center;
        }
        .note-modal-overlay.active {
            display: flex;
        }
        .note-modal {
            background: #16181c;
            border: 1px solid #2f3336;
            border-radius: 16px;
            padding: 24px;
            width: 90%;
            max-width: 500px;
            max-height: 80vh;
            overflow: hidden;
            display: flex;
            flex-direction: column;
        }
        .note-modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 16px;
            padding-bottom: 12px;
            border-bottom: 1px solid #2f3336;
        }
        .note-modal-title {
            font-weight: 600;
            font-size: 16px;
            color: #e7e9ea;
        }
        .note-modal-close {
            background: none;
            border: none;
            color: #71767b;
            font-size: 24px;
            cursor: pointer;
            padding: 0;
            line-height: 1;
        }
        .note-modal-close:hover { color: #e7e9ea; }
        .note-modal-textarea {
            background: #1d1f23;
            border: 1px solid #2f3336;
            border-radius: 8px;
            color: #e7e9ea;
            font-size: 14px;
            padding: 12px;
            width: 100%;
            min-height: 150px;
            resize: vertical;
            font-family: inherit;
        }
        .note-modal-textarea:focus {
            outline: none;
            border-color: #1d9bf0;
        }
        .note-modal-textarea::placeholder {
            color: #71767b;
        }
        .note-preview {
            cursor: pointer;
            max-width: 200px;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
            padding: 4px 8px;
            border-radius: 4px;
            font-size: 13px;
            color: #71767b;
            transition: background 0.2s;
        }
        .note-preview:hover {
            background: #1d1f23;
        }
        .note-preview.has-note {
            color: #a855f7;
        }
        .note-preview-empty {
            font-style: italic;
        }
    </style>
</head>
<body>
    <div class="header">
        <h1>üìä AE Dashboard - Steven Econs</h1>
        <div class="sync-info">Data: <span id="syncTime">Loading...</span></div>
    </div>
    
    <div class="stats">
        <div class="stat-card stat-hot">
            <div class="stat-value" id="hotCount">-</div>
            <div class="stat-label">üî• Hot Accounts</div>
        </div>
        <div class="stat-card stat-active">
            <div class="stat-value" id="activeCount">-</div>
            <div class="stat-label">üü¢ Active</div>
        </div>
        <div class="stat-card stat-expiring">
            <div class="stat-value" id="expiringCount">-</div>
            <div class="stat-label">üü° Expiring Soon</div>
        </div>
        <div class="stat-card stat-none">
            <div class="stat-value" id="noActivityCount">-</div>
            <div class="stat-label">‚ö™ No Activity</div>
        </div>
    </div>
    
    <div class="filters">
        <button class="filter-btn active" data-filter="all" data-type="all">All</button>
        <button class="filter-btn hot-filter" data-filter="hot" data-type="hot">üî• Hot</button>
        <button class="filter-btn notes-filter" data-filter="has_notes" data-type="has_notes">üìù With Notes</button>
        <button class="filter-btn opp-filter" data-filter="open_opp" data-type="open_opp">üí∞ Open Opps</button>
        <span style="color:#2f3336; margin: 0 8px;">|</span>
        <button class="filter-btn" data-filter="P1" data-type="priority">üî¥ P1</button>
        <button class="filter-btn" data-filter="P2" data-type="priority">üü° P2</button>
        <button class="filter-btn" data-filter="P3" data-type="priority">‚ö™ P3</button>
        <span style="color:#2f3336; margin: 0 8px;">|</span>
        <button class="filter-btn" data-filter="expired" data-type="roe">ROE Expired</button>
        <button class="filter-btn" data-filter="expiring_soon" data-type="roe">ROE Expiring</button>
        <span style="color:#2f3336; margin: 0 8px;">|</span>
        <button class="filter-btn bdr-filter" data-filter="Timothy Allison" data-type="bdr">Timothy A</button>
        <button class="filter-btn bdr-filter" data-filter="Quinn Marcy" data-type="bdr">Quinn M</button>
        <input type="text" class="search" placeholder="Search accounts..." id="searchInput">
        <button class="export-btn" onclick="exportData()">üì§ Export</button>
    </div>
    
    <table>
        <thead>
            <tr>
                <th data-sort="hot">üî•</th>
                <th data-sort="opp">üí∞</th>
                <th data-sort="priority">P</th>
                <th data-sort="name">Account</th>
                <th data-sort="status">ROE Status</th>
                <th data-sort="days">Days</th>
                <th data-sort="bdr">BDR</th>
                <th data-sort="steve-notes">Steve Notes</th>
                <th data-sort="bdr-notes">BDR Notes</th>
            </tr>
        </thead>
        <tbody id="accountsTable"></tbody>
    </table>

    <!-- Note Modal -->
    <div class="note-modal-overlay" id="noteModal" onclick="closeNoteModal(event)">
        <div class="note-modal" onclick="event.stopPropagation()">
            <div class="note-modal-header">
                <span class="note-modal-title" id="noteModalTitle">Notes</span>
                <button class="note-modal-close" onclick="closeNoteModal()">&times;</button>
            </div>
            <textarea class="note-modal-textarea" id="noteModalTextarea" placeholder="Add notes about this account..."></textarea>
        </div>
    </div>

    <script>
        let allAccounts = [];
        let activeFilters = {}; // { hot: true, bdr: 'Quinn Marcy', priority: 'P1' }
        let sortColumn = 'priority';
        let sortDirection = 'asc';
        let sharedHotAccounts = {}; // From API
        
        const SYNC_API = 'https://ae-dashboard-sync.steven-econs.workers.dev';
        
        // Hot accounts - synced via Cloudflare Worker
        function getHotAccounts() {
            return sharedHotAccounts;
        }
        
        function isHot(accountId) {
            return !!sharedHotAccounts[accountId];
        }
        
        function updateHotCount() {
            const count = Object.keys(sharedHotAccounts).filter(id => sharedHotAccounts[id]).length;
            document.getElementById('hotCount').textContent = count;
        }
        
        async function loadSharedHotAccounts() {
            try {
                const resp = await fetch(`${SYNC_API}/hot`);
                sharedHotAccounts = await resp.json();
            } catch (e) {
                console.log('Failed to load hot accounts from API, trying local file');
                try {
                    const resp = await fetch('hot-accounts.json');
                    sharedHotAccounts = await resp.json();
                } catch (e2) {
                    sharedHotAccounts = {};
                }
            }
        }
        
        async function toggleHot(accountId) {
            // Toggle locally first for instant feedback
            if (sharedHotAccounts[accountId]) {
                delete sharedHotAccounts[accountId];
            } else {
                sharedHotAccounts[accountId] = Date.now();
            }
            updateHotCount();
            renderTable(filterAndSortAccounts());
            
            // Sync to server
            try {
                await fetch(`${SYNC_API}/hot`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(sharedHotAccounts),
                });
            } catch (e) {
                console.error('Failed to sync hot accounts:', e);
            }
        }
        
        // Notes - synced via Cloudflare Worker
        let sharedSteveNotes = {};
        let sharedBdrNotes = {};
        
        function getSteveNotes() {
            return sharedSteveNotes;
        }
        
        function getBdrNotes() {
            return sharedBdrNotes;
        }
        
        function getSteveNote(accountId) {
            return sharedSteveNotes[accountId] || '';
        }
        
        function getBdrNote(accountId) {
            return sharedBdrNotes[accountId] || '';
        }
        
        async function loadSharedNotes() {
            try {
                const [steveResp, bdrResp] = await Promise.all([
                    fetch(`${SYNC_API}/notes`),
                    fetch(`${SYNC_API}/bdr-notes`)
                ]);
                sharedSteveNotes = await steveResp.json();
                sharedBdrNotes = await bdrResp.json();
            } catch (e) {
                console.log('Failed to load notes from API');
                sharedSteveNotes = {};
                sharedBdrNotes = {};
            }
        }
        
        let noteSyncTimeout = null;
        let currentNoteAccountId = null;
        let currentNoteType = null; // 'steve' or 'bdr'
        
        function openNoteModal(accountId, accountName, noteType) {
            currentNoteAccountId = accountId;
            currentNoteType = noteType;
            const label = noteType === 'steve' ? 'Steve Notes' : 'BDR Notes';
            document.getElementById('noteModalTitle').textContent = `${accountName} - ${label}`;
            document.getElementById('noteModalTextarea').value = noteType === 'steve' ? getSteveNote(accountId) : getBdrNote(accountId);
            document.getElementById('noteModal').classList.add('active');
            document.getElementById('noteModalTextarea').focus();
        }
        
        function closeNoteModal(event) {
            if (event && event.target !== event.currentTarget) return;
            document.getElementById('noteModal').classList.remove('active');
            currentNoteAccountId = null;
            currentNoteType = null;
        }
        
        function handleNoteChange(accountId, note, noteType) {
            const notes = noteType === 'steve' ? sharedSteveNotes : sharedBdrNotes;
            const endpoint = noteType === 'steve' ? '/notes' : '/bdr-notes';
            
            // Update locally
            if (note && note.trim()) {
                notes[accountId] = note.trim();
            } else {
                delete notes[accountId];
            }
            
            // Debounce sync (wait 500ms after typing stops)
            clearTimeout(noteSyncTimeout);
            noteSyncTimeout = setTimeout(async () => {
                try {
                    await fetch(`${SYNC_API}${endpoint}`, {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify(notes),
                    });
                    // Re-render to update the preview
                    renderTable(filterAndSortAccounts());
                } catch (e) {
                    console.error('Failed to sync notes:', e);
                }
            }, 500);
        }
        
        // Listen for textarea changes in modal
        document.addEventListener('DOMContentLoaded', () => {
            const textarea = document.getElementById('noteModalTextarea');
            textarea.addEventListener('input', () => {
                if (currentNoteAccountId && currentNoteType) {
                    handleNoteChange(currentNoteAccountId, textarea.value, currentNoteType);
                }
            });
        });
        
        // Close modal on Escape
        document.addEventListener('keydown', (e) => {
            if (e.key === 'Escape') closeNoteModal();
        });
        
        function exportData() {
            const hot = getHotAccounts();
            const notes = getNotes();
            
            const exportList = allAccounts
                .filter(a => hot[a.salesforce_id] || notes[a.salesforce_id])
                .map(a => ({
                    name: a.name,
                    id: a.salesforce_id,
                    url: a.salesforce_url,
                    hot: !!hot[a.salesforce_id],
                    note: notes[a.salesforce_id] || ''
                }));
            
            const text = JSON.stringify(exportList, null, 2);
            navigator.clipboard.writeText(text).then(() => {
                alert(`Copied ${exportList.length} accounts (hot + notes) to clipboard!`);
            }).catch(() => {
                prompt('Copy this:', text);
            });
        }
        
        async function loadData() {
            try {
                // Load shared data first
                await Promise.all([loadSharedHotAccounts(), loadSharedNotes()]);
                
                const resp = await fetch('accounts.json');
                const data = await resp.json();
                
                document.getElementById('syncTime').textContent = new Date(data.synced_at).toLocaleDateString();
                document.getElementById('expiringCount').textContent = data.summary.expiring_soon;
                document.getElementById('activeCount').textContent = data.summary.active;
                document.getElementById('noActivityCount').textContent = data.summary.no_activity;
                updateHotCount();
                
                allAccounts = data.accounts;
                renderTable(filterAndSortAccounts());
            } catch (e) {
                console.error('Error loading data:', e);
                document.getElementById('accountsTable').innerHTML = 
                    '<tr><td colspan="7" class="empty-state">Error loading data.</td></tr>';
            }
        }
        
        function filterAndSortAccounts() {
            const search = document.getElementById('searchInput').value.toLowerCase();
            const steveNotes = getSteveNotes();
            const bdrNotes = getBdrNotes();
            let filtered = allAccounts;
            
            // Apply all active filters (AND logic)
            if (activeFilters.hot) {
                filtered = filtered.filter(a => isHot(a.salesforce_id));
            }
            if (activeFilters.has_notes) {
                filtered = filtered.filter(a => steveNotes[a.salesforce_id] || bdrNotes[a.salesforce_id]);
            }
            if (activeFilters.open_opp) {
                filtered = filtered.filter(a => a.has_open_opp);
            }
            if (activeFilters.priority) {
                filtered = filtered.filter(a => a.priority === activeFilters.priority);
            }
            if (activeFilters.roe) {
                filtered = filtered.filter(a => a.roe_status === activeFilters.roe);
            }
            if (activeFilters.bdr) {
                filtered = filtered.filter(a => a.bdr_name === activeFilters.bdr);
            }
            
            // Apply search
            if (search) {
                filtered = filtered.filter(a => 
                    a.name.toLowerCase().includes(search) ||
                    (a.industry && a.industry.toLowerCase().includes(search)) ||
                    (a.city && a.city.toLowerCase().includes(search)) ||
                    (steveNotes[a.salesforce_id] && steveNotes[a.salesforce_id].toLowerCase().includes(search)) ||
                    (bdrNotes[a.salesforce_id] && bdrNotes[a.salesforce_id].toLowerCase().includes(search))
                );
            }
            
            // Sort
            filtered.sort((a, b) => {
                let aVal, bVal;
                switch(sortColumn) {
                    case 'hot':
                        aVal = isHot(a.salesforce_id) ? 1 : 0;
                        bVal = isHot(b.salesforce_id) ? 1 : 0;
                        break;
                    case 'opp':
                        aVal = a.has_open_opp ? 1 : 0;
                        bVal = b.has_open_opp ? 1 : 0;
                        break;
                    case 'priority':
                        const pOrder = { 'P1': 1, 'P2': 2, 'P3': 3 };
                        aVal = pOrder[a.priority] || 99;
                        bVal = pOrder[b.priority] || 99;
                        break;
                    case 'name':
                        aVal = a.name.toLowerCase();
                        bVal = b.name.toLowerCase();
                        break;
                    case 'status':
                        const sOrder = { 'expired': 1, 'expiring_soon': 2, 'active': 3, 'no_activity': 4 };
                        aVal = sOrder[a.roe_status] || 99;
                        bVal = sOrder[b.roe_status] || 99;
                        break;
                    case 'days':
                        aVal = a.days_remaining === -999 ? 9999 : a.days_remaining;
                        bVal = b.days_remaining === -999 ? 9999 : b.days_remaining;
                        break;
                    case 'steve-notes':
                        aVal = steveNotes[a.salesforce_id] ? 0 : 1;
                        bVal = steveNotes[b.salesforce_id] ? 0 : 1;
                        break;
                    case 'bdr-notes':
                        aVal = bdrNotes[a.salesforce_id] ? 0 : 1;
                        bVal = bdrNotes[b.salesforce_id] ? 0 : 1;
                        break;
                    case 'bdr':
                        aVal = (a.bdr_name || 'zzz').toLowerCase();
                        bVal = (b.bdr_name || 'zzz').toLowerCase();
                        break;
                    default:
                        aVal = 0; bVal = 0;
                }
                
                if (aVal < bVal) return sortDirection === 'asc' ? -1 : 1;
                if (aVal > bVal) return sortDirection === 'asc' ? 1 : -1;
                return 0;
            });
            
            return filtered;
        }
        
        function renderTable(accounts) {
            const tbody = document.getElementById('accountsTable');
            
            if (accounts.length === 0) {
                tbody.innerHTML = '<tr><td colspan="9" class="empty-state">No accounts match your filters</td></tr>';
                return;
            }
            
            const steveNotes = getSteveNotes();
            const bdrNotes = getBdrNotes();
            
            tbody.innerHTML = accounts.map(acc => {
                const daysClass = acc.days_remaining < 0 ? 'days-negative' : 
                                  acc.days_remaining <= 7 ? 'days-warning' : 'days-ok';
                const daysText = acc.days_remaining === -999 ? '-' : 
                                 acc.days_remaining < 0 ? `${Math.abs(acc.days_remaining)}d over` :
                                 `${acc.days_remaining}d`;
                
                const priorityClass = acc.priority ? `priority-${acc.priority}` : 'priority-none';
                const accountIsHot = isHot(acc.salesforce_id);
                const hotClass = accountIsHot ? 'is-hot' : '';
                const oppIndicator = acc.has_open_opp ? 'üí∞' : '<span class="opp-none">üí∞</span>';
                const steveNoteValue = steveNotes[acc.salesforce_id] || '';
                const steveNoteClass = steveNoteValue ? 'has-note' : '';
                const bdrNoteValue = bdrNotes[acc.salesforce_id] || '';
                const bdrNoteClass = bdrNoteValue ? 'has-note' : '';
                
                return `
                    <tr>
                        <td><span class="hot-toggle ${hotClass}" onclick="toggleHot('${acc.salesforce_id}')">üî•</span></td>
                        <td>${oppIndicator}</td>
                        <td><span class="priority-badge ${priorityClass}">${acc.priority || '-'}</span></td>
                        <td>
                            <a href="${acc.salesforce_url}" target="_blank" class="account-name">${acc.name}</a>
                            <div class="account-meta">${acc.city || ''}${acc.city && acc.state ? ', ' : ''}${acc.state || ''}</div>
                        </td>
                        <td><span class="status-badge status-${acc.roe_status}">${formatStatus(acc.roe_status)}</span></td>
                        <td class="days-remaining ${daysClass}">${daysText}</td>
                        <td style="color:#71767b;font-size:13px">${acc.bdr_name || '-'}</td>
                        <td class="note-cell">
                            <div class="note-preview ${steveNoteClass}" onclick="openNoteModal('${acc.salesforce_id}', '${escapeHtml(acc.name)}', 'steve')">
                                ${steveNoteValue ? escapeHtml(steveNoteValue) : '<span class="note-preview-empty">+ Add</span>'}
                            </div>
                        </td>
                        <td class="note-cell">
                            <div class="note-preview ${bdrNoteClass}" onclick="openNoteModal('${acc.salesforce_id}', '${escapeHtml(acc.name)}', 'bdr')">
                                ${bdrNoteValue ? escapeHtml(bdrNoteValue) : '<span class="note-preview-empty">+ Add</span>'}
                            </div>
                        </td>
                    </tr>
                `;
            }).join('');
        }
        
        function escapeHtml(text) {
            const div = document.createElement('div');
            div.textContent = text;
            return div.innerHTML.replace(/"/g, '&quot;');
        }
        
        function formatStatus(status) {
            const labels = {
                'expired': 'Expired',
                'expiring_soon': 'Expiring',
                'active': 'Active',
                'no_activity': 'No Activity'
            };
            return labels[status] || status;
        }
        
        // Event listeners - multi-filter support
        document.querySelectorAll('.filter-btn').forEach(btn => {
            btn.addEventListener('click', () => {
                const filterType = btn.dataset.type;
                const filterValue = btn.dataset.filter;
                
                // "All" clears all filters
                if (filterValue === 'all') {
                    activeFilters = {};
                    document.querySelectorAll('.filter-btn').forEach(b => b.classList.remove('active'));
                    btn.classList.add('active');
                } else {
                    // Remove "All" active state when selecting other filters
                    document.querySelector('[data-filter="all"]').classList.remove('active');
                    
                    // Toggle this filter
                    if (btn.classList.contains('active')) {
                        // Turn off this filter
                        btn.classList.remove('active');
                        delete activeFilters[filterType];
                        
                        // If no filters active, show "All" as active
                        if (Object.keys(activeFilters).length === 0) {
                            document.querySelector('[data-filter="all"]').classList.add('active');
                        }
                    } else {
                        // Turn on this filter (and turn off others in same group)
                        // For priority and bdr, only one can be active
                        if (filterType === 'priority' || filterType === 'bdr' || filterType === 'roe') {
                            document.querySelectorAll(`[data-type="${filterType}"]`).forEach(b => b.classList.remove('active'));
                        }
                        btn.classList.add('active');
                        
                        // Boolean filters
                        if (filterType === 'hot' || filterType === 'has_notes' || filterType === 'open_opp') {
                            activeFilters[filterType] = true;
                        } else {
                            activeFilters[filterType] = filterValue;
                        }
                    }
                }
                renderTable(filterAndSortAccounts());
            });
        });
        
        document.getElementById('searchInput').addEventListener('input', () => {
            renderTable(filterAndSortAccounts());
        });
        
        document.querySelectorAll('th[data-sort]').forEach(th => {
            th.addEventListener('click', () => {
                const col = th.dataset.sort;
                if (sortColumn === col) {
                    sortDirection = sortDirection === 'asc' ? 'desc' : 'asc';
                } else {
                    sortColumn = col;
                    sortDirection = 'asc';
                }
                document.querySelectorAll('th').forEach(t => t.classList.remove('sorted-asc', 'sorted-desc'));
                th.classList.add(sortDirection === 'asc' ? 'sorted-asc' : 'sorted-desc');
                renderTable(filterAndSortAccounts());
            });
        });
        
        // Set initial sort indicator
        document.querySelector('th[data-sort="priority"]').classList.add('sorted-asc');
        
        // Load data
        loadData();
    </script>
</body>
</html>
